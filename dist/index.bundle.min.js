var t=class{defaultOptions={spacing:1,numCircles:1e3,minRadius:1,maxRadius:10,higherAccuracy:!1,colors:"auto",minAlpha:1,background:"transparent"};defaultExportOptions={scale:globalThis.devicePixelRatio||1,quality:1,format:"image/png"};options;spareCircles=[];placedCircles=[];dims={width:0,height:0};constructor(t={}){this.options={...this.defaultOptions,...t},["transparent",null,"",!1,void 0].includes(this.options.background)&&(this.options.background=!1);for(let t=0;t<this.options.numCircles;t++)this.spareCircles.push({radius:this.options.minRadius+Math.random()*Math.random()*(this.options.maxRadius-this.options.minRadius)});this.spareCircles.sort(((t,i)=>t.radius-i.radius))}isFilled(t,i,e){return i=Math.round(i),e=Math.round(e),t.data[4*(this.dims.width*e+i)+3]>this.options.minAlpha}isCircleInside(t,i,e,s){if(!this.isFilled(t,i,e-s))return!1;if(!this.isFilled(t,i,e+s))return!1;if(!this.isFilled(t,i+s,e))return!1;if(!this.isFilled(t,i-s,e))return!1;if(this.options.higherAccuracy){const s=Math.cos(Math.PI/4);if(!this.isFilled(t,i+s,e+s))return!1;if(!this.isFilled(t,i-s,e+s))return!1;if(!this.isFilled(t,i-s,e-s))return!1;if(!this.isFilled(t,i+s,e-s))return!1}return!0}touchesPlacedCircle(t,i,e){return this.placedCircles.some((s=>this.dist(t,i,s.x,s.y)<s.radius+e+this.options.spacing))}dist(t,i,e,s){const n=t-e,a=i-s;return Math.sqrt(n*n+a*a)}getCircleColor(t,i,e){if("auto"===this.options.colors){i=Math.round(i),e=Math.round(e);const s=4*(this.dims.width*e+i);if(t.data[s+3]/255<this.options.minAlpha)return!1;return`rgb(${t.data[s]},${t.data[s+1]},${t.data[s+2]})`}return this.options.colors[Math.floor(Math.random()*this.options.colors.length)]}render(t,i){let e=this.spareCircles.length;for(this.dims={width:i,height:t.data.length/i/4};e>0;){e--;const i=this.spareCircles[e];let s=1e3;for(;!i.x&&s-- >0;){const e=Math.random()*this.dims.width,s=Math.random()*this.dims.height;if(this.isCircleInside(t,e,s,i.radius)&&!this.touchesPlacedCircle(e,s,i.radius)){const n=this.getCircleColor(t,e,s);n&&(i.x=e,i.y=s,i.color=n,this.placedCircles.push(i))}}}return this.placedCircles}asSVGString(){return`<svg width="${this.dims.width}" height="${this.dims.height}" viewBox="0 0 ${this.dims.width} ${this.dims.height}" xmlns="http://www.w3.org/2000/svg">`+(this.options.background?`<rect x="0" y="0" width="${this.dims.width}" height="${this.dims.height}" fill="${this.options.background}" />`:"")+this.placedCircles.map((t=>{const{x:i,y:e,radius:s,color:n}=t;return`<circle cx="${i}" cy="${e}" r="${s}" fill="${n}" />`})).join("")+"</svg>"}asSVG(){const t=this.asSVGString();return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement}asCanvas(t={}){const i=(t={...this.defaultExportOptions,...t}).scale,e=document.createElement("canvas");e.width=this.dims.width*i,e.height=this.dims.height*i;const s=e.getContext("2d");this.options.background&&(s.fillStyle=this.options.background,s.fillRect(0,0,e.width,e.height));for(const t of this.placedCircles){const{x:e,y:n,radius:a,color:r}=t;s.fillStyle=String(r),s.beginPath(),s.arc(Number(e*i),Number(n*i),a*i,0,2*Math.PI),s.closePath(),s.fill()}return e}asImageData(t={}){t={...this.defaultExportOptions,...t};const i=this.asCanvas(t);return i.getContext("2d").getImageData(0,0,i.width,i.height)}async asBlob(t={}){t={...this.defaultExportOptions,...t};const i=this.asCanvas(t);return await new Promise(((e,s)=>{i.toBlob((t=>{t?e(t):s(new Error("Blob creation failed"))}),t.format,t.quality)}))}async asBlobURL(t={}){return URL.createObjectURL(await this.asBlob(t))}asDataURL(t={}){return t={...this.defaultExportOptions,...t},this.asCanvas().toDataURL(t.format,t.quality)}asArray(){return this.placedCircles}};function i(i,e={}){return function(i,e,s={}){const n=new t(s);return n.render(i,e),n}(i.getImageData(0,0,i.canvas.width,i.canvas.height),i.canvas.width,e)}function e(t,e={}){return i(t.getContext("2d"),e)}function s(t,i){return"number"==typeof i?i+t:t+t*(parseFloat(i)/100)*2}function n(t,i){return function(t,i){const e=document.createElement("canvas");return e.width=t,e.height=i,e}(t,i).getContext("2d")}function a(t,i,e,s=4){const a=n(t,i);a.beginPath();for(let n=0;n<i;n+=s)for(let i=0;i<t;i+=s)a.fillStyle=e[Math.floor(Math.random()*e.length)],a.fillRect(i,n,s,s);return a.closePath(),a.canvas}function r(t,i,e,s,a,r,o="black"){const c=n(t,i);return c.font=r,c.textAlign="center",c.textBaseline="middle",c.fillStyle=o,c.fillText(a,e,s),c.canvas}function o(t,i,e,s,n){const a=[["#ffffff",10],["#000000",3]];t.lineCap="round";for(const n of a){const[a,r]=n;t.strokeStyle=a,t.lineWidth=r,t.beginPath(),t.moveTo(i-10,e),t.lineTo(i+10,e),t.moveTo(i,e),t.lineTo(i,s),t.moveTo(i-10,s),t.lineTo(i+10,s),t.stroke(),t.closePath()}t.font="12px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#000000",t.strokeStyle="#ffffff",t.strokeText(n,i,.5*(e+s)),t.fillText(n,i,.5*(e+s))}function c(t,i){const e=n(t.width,t.height);return e.drawImage(t,0,0),e.globalCompositeOperation="destination-in",e.drawImage(i,0,0),e.globalCompositeOperation="source-over",e.canvas}var l=async function(t={}){const i={textColors:["#ffffff"],backgroundColors:["#000000"],text:"8",font:"bold 256px sans-serif",padding:"20%",margin:"10%",circlePackerOptions:{},radius:"auto",debug:!1},l={...i,...t,circlePackerOptions:{...i.circlePackerOptions,...t.circlePackerOptions}};l.text=l.text.slice(0,2);const d=function(t,i){const e=n(2048,2048);e.font=i,e.textAlign="center",e.textBaseline="middle";const s=e.measureText(t),a=s.width,r=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;return{textWidth:a,textHeight:r,yOffset:1024-(1024-s.actualBoundingBoxAscent+.5*r),edgeLength:Math.max(a,r)}}(l.text,l.font),h="auto"===l.radius?d.edgeLength/2:l.radius,u=s(h,l.padding),g=s(2*u,l.margin),f=.5*g,p=.5*g+d.yOffset,m=r(g,g,f,p,l.text,l.font),x=n(g,g);x.beginPath(),x.arc(.5*g,.5*g,u,0,2*Math.PI),x.fill(),x.closePath();const b=c(a(g,g,l.backgroundColors),x.canvas),w=c(a(g,g,l.textColors),m),C=n(g,g);if(C.drawImage(b,0,0),C.drawImage(w,0,0),l.debug){const t=n(4*g,g);t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,4*g,g);const i=function(t,i,e,s,n,a,c){const l=r(t,i,e,s,n,a,"rgba(0, 0, 0, 0.5)"),d=l.getContext("2d");d.beginPath(),d.setLineDash([5,5]),d.lineWidth=2,d.font=a,d.textAlign="center",d.textBaseline="middle",d.strokeText(n,e,s-c.yOffset),d.closePath(),d.setLineDash([]);const h=s-2*c.yOffset-.5*c.textHeight;return o(d,.5*t+.5*c.textWidth,h,h+c.yOffset,"offset: "+c.yOffset.toFixed(2)+"px"),l}(g,g,f,p,l.text,l.font,d);t.drawImage(i,0,0),t.drawImage(C.canvas,2*g,0);const s=e(C.canvas,l.circlePackerOptions).asCanvas({scale:1});t.drawImage(s,3*g,0);const a=n(g,g);return a.drawImage(m,0,0),a.fillStyle="rgba(255, 255, 255, 0.75)",a.beginPath(),a.rect(0,0,g,g),a.fill(),a.closePath(),a.drawImage(function(t,i,e){const s=n(i,e);s.lineWidth=2,s.beginPath(),s.arc(.5*i,.5*e,t.innerRadius,0,2*Math.PI),s.stroke(),s.closePath(),s.beginPath(),s.arc(.5*i,.5*e,t.backgroundRadius,0,2*Math.PI),s.stroke(),s.closePath();const a=.5*(t.edgeLength-2*t.backgroundRadius),r=`margin: ${a.toFixed(2)}px (${t.mergedOptions.margin})`;o(s,.5*i,0,a,r);const c=t.backgroundRadius-t.innerRadius,l=`padding: ${c.toFixed(2)}px (${t.mergedOptions.padding})`;o(s,.5*i,a+2*t.innerRadius+c,a+2*t.innerRadius+2*c,l);const d=t.innerRadius,h=`radius: ${d.toFixed(2)}px (${t.mergedOptions.radius})`;return o(s,.5*i,a+c,a+c+d,h),s.canvas}({innerRadius:h,backgroundRadius:u,edgeLength:g,mergedOptions:l},g,g),0,0),t.drawImage(a.canvas,g,0),new Proxy({},{get:()=>function(){return t.canvas}})}return e(C.canvas,l.circlePackerOptions)};export{l as default};
