var ishihara=function(){"use strict";var t={pack(t,e,i,s){let a=i.length;const n=[],o={width:e,height:t.data.length/e/4};for(;a>0;){a--;const e=i[a];let r=1e3;for(;!e.x&&r-- >0;){const i=Math.random()*o.width,a=Math.random()*o.height;this.isCircleInside(t,o.width,i,a,e.radius,s.higherAccuracy,s.minAlpha)&&(this.touchesPlacedCircle(i,a,e.radius,n,s.spacing)||(e.x=i,e.y=a,n.push(e)))}}return n},isFilled:(t,e,i,s,a)=>(e=Math.round(e),i=Math.round(i),t.data[4*(s*i+e)+3]>a),isCircleInside(t,e,i,s,a,n,o){if(!this.isFilled(t,i,s-a,e,o))return!1;if(!this.isFilled(t,i,s+a,e,o))return!1;if(!this.isFilled(t,i+a,s,e,o))return!1;if(!this.isFilled(t,i-a,s,e,o))return!1;if(n){const a=Math.cos(Math.PI/4);if(!this.isFilled(t,i+a,s+a,e,o))return!1;if(!this.isFilled(t,i-a,s+a,e,o))return!1;if(!this.isFilled(t,i-a,s-a,e,o))return!1;if(!this.isFilled(t,i+a,s-a,e,o))return!1}return!0},touchesPlacedCircle(t,e,i,s,a){return s.some((s=>this.dist(t,e,s.x,s.y)<s.radius+i+a))},dist(t,e,i,s){const a=t-i,n=e-s;return Math.sqrt(a*a+n*n)}},e=class{defaultOptions={spacing:1,numCircles:1e3,minRadius:1,maxRadius:10,higherAccuracy:!1,colors:"auto",minAlpha:1,background:"transparent",useMainThread:!1,reuseWorker:!0};defaultExportOptions={scale:globalThis.devicePixelRatio||1,quality:1,format:"image/png"};options;spareCircles=[];placedCircles=[];dims={width:0,height:0};worker=null;constructor(t={}){this.options={...this.defaultOptions,...t},["transparent",null,"",!1,void 0].includes(this.options.background)&&(this.options.background=!1);for(let t=0;t<this.options.numCircles;t++)this.spareCircles.push({radius:this.options.minRadius+Math.random()*Math.random()*(this.options.maxRadius-this.options.minRadius)});this.spareCircles.sort(((t,e)=>t.radius-e.radius))}getCircleColor(t,e,i){if("auto"===this.options.colors){e=Math.round(e),i=Math.round(i);const s=4*(this.dims.width*i+e);if(t.data[s+3]/255<this.options.minAlpha)return!1;return`rgb(${t.data[s]},${t.data[s+1]},${t.data[s+2]})`}return this.options.colors[Math.floor(Math.random()*this.options.colors.length)]}async pack(e,i){let s=[];return"undefined"==typeof Worker||this.options.useMainThread?s=t.pack(e,i,this.spareCircles,this.options):(this.worker||(this.worker=new Worker("data:text/javascript;base64,dmFyIENvcmVfZGVmYXVsdD17cGFjayhpLHQsZSxzKXtsZXQgcj1lLmxlbmd0aDtjb25zdCBhPVtdLGQ9e3dpZHRoOnQsaGVpZ2h0OmkuZGF0YS5sZW5ndGgvdC80fTtmb3IoO3I+MDspe3ItLTtjb25zdCB0PWVbcl07bGV0IGg9MWUzO2Zvcig7IXQueCYmaC0tID4wOyl7Y29uc3QgZT1NYXRoLnJhbmRvbSgpKmQud2lkdGgscj1NYXRoLnJhbmRvbSgpKmQuaGVpZ2h0O3RoaXMuaXNDaXJjbGVJbnNpZGUoaSxkLndpZHRoLGUscix0LnJhZGl1cyxzLmhpZ2hlckFjY3VyYWN5LHMubWluQWxwaGEpJiYodGhpcy50b3VjaGVzUGxhY2VkQ2lyY2xlKGUscix0LnJhZGl1cyxhLHMuc3BhY2luZyl8fCh0Lng9ZSx0Lnk9cixhLnB1c2godCkpKX19cmV0dXJuIGF9LGlzRmlsbGVkOihpLHQsZSxzLHIpPT4odD1NYXRoLnJvdW5kKHQpLGU9TWF0aC5yb3VuZChlKSxpLmRhdGFbNCoocyplK3QpKzNdPnIpLGlzQ2lyY2xlSW5zaWRlKGksdCxlLHMscixhLGQpe2lmKCF0aGlzLmlzRmlsbGVkKGksZSxzLXIsdCxkKSlyZXR1cm4hMTtpZighdGhpcy5pc0ZpbGxlZChpLGUscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3Iscyx0LGQpKXJldHVybiExO2lmKCF0aGlzLmlzRmlsbGVkKGksZS1yLHMsdCxkKSlyZXR1cm4hMTtpZihhKXtjb25zdCByPU1hdGguY29zKE1hdGguUEkvNCk7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3IscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlLXIscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlLXIscy1yLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3Iscy1yLHQsZCkpcmV0dXJuITF9cmV0dXJuITB9LHRvdWNoZXNQbGFjZWRDaXJjbGUoaSx0LGUscyxyKXtyZXR1cm4gcy5zb21lKChzPT50aGlzLmRpc3QoaSx0LHMueCxzLnkpPHMucmFkaXVzK2UrcikpfSxkaXN0KGksdCxlLHMpe2NvbnN0IHI9aS1lLGE9dC1zO3JldHVybiBNYXRoLnNxcnQocipyK2EqYSl9fTtzZWxmLm9ubWVzc2FnZT1pPT57cG9zdE1lc3NhZ2UoQ29yZV9kZWZhdWx0LnBhY2soaS5kYXRhLmltYWdlRGF0YSxpLmRhdGEuaW1hZ2VXaWR0aCxpLmRhdGEuc3BhcmVDaXJjbGVzLGkuZGF0YS5vcHRpb25zKSl9Ow==")),s=await new Promise((t=>{this.worker.onmessage=e=>t(e.data),this.worker.postMessage({imageData:e,imageWidth:i,spareCircles:this.spareCircles,options:this.options})})),this.options.reuseWorker||this.worker.terminate()),this.dims={width:i,height:e.data.length/i/4},this.placedCircles=s.reduce(((t,i)=>{const s=this.getCircleColor(e,i.x,i.y);return s&&(i.color=s,t.push(i)),t}),[]),this.placedCircles}asSVGString(){return`<svg width="${this.dims.width}" height="${this.dims.height}" viewBox="0 0 ${this.dims.width} ${this.dims.height}" xmlns="http://www.w3.org/2000/svg">`+(this.options.background?`<rect x="0" y="0" width="${this.dims.width}" height="${this.dims.height}" fill="${this.options.background}" />`:"")+this.placedCircles.map((t=>{const{x:e,y:i,radius:s,color:a}=t;return`<circle cx="${e}" cy="${i}" r="${s}" fill="${a}" />`})).join("")+"</svg>"}asSVG(){const t=this.asSVGString();return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement}asCanvas(t={}){const e=(t={...this.defaultExportOptions,...t}).scale,i=document.createElement("canvas");i.width=this.dims.width*e,i.height=this.dims.height*e;const s=i.getContext("2d");this.options.background&&(s.fillStyle=this.options.background,s.fillRect(0,0,i.width,i.height));for(const t of this.placedCircles){const{x:i,y:a,radius:n,color:o}=t;s.fillStyle=String(o),s.beginPath(),s.arc(Number(i*e),Number(a*e),n*e,0,2*Math.PI),s.closePath(),s.fill()}return i}asImageData(t={}){t={...this.defaultExportOptions,...t};const e=this.asCanvas(t);return e.getContext("2d").getImageData(0,0,e.width,e.height)}async asBlob(t={}){t={...this.defaultExportOptions,...t};const e=this.asCanvas(t);return await new Promise(((i,s)=>{e.toBlob((t=>{t?i(t):s(new Error("Blob creation failed"))}),t.format,t.quality)}))}async asBlobURL(t={}){return URL.createObjectURL(await this.asBlob(t))}asDataURL(t={}){return t={...this.defaultExportOptions,...t},this.asCanvas().toDataURL(t.format,t.quality)}asArray(){return this.placedCircles}};async function i(t,i={}){return await async function(t,i,s={}){const a=new e(s);return await a.pack(t,i),a}(t.getImageData(0,0,t.canvas.width,t.canvas.height),t.canvas.width,i)}async function s(t,e={}){const s=t.getContext("2d");return await i(s,e)}function a(t,e){return"number"==typeof e?e+t:t+t*(parseFloat(e)/100)*2}function n(t,e){return function(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i}(t,e).getContext("2d")}function o(t,e,i,s=4){const a=n(t,e);a.beginPath();for(let n=0;n<e;n+=s)for(let e=0;e<t;e+=s)a.fillStyle=i[Math.floor(Math.random()*i.length)],a.fillRect(e,n,s,s);return a.closePath(),a.canvas}function r(t,e,i,s,a,o,r="black"){const c=n(t,e);return c.font=o,c.textAlign="center",c.textBaseline="middle",c.fillStyle=r,c.fillText(a,i,s),c.canvas}function c(t,e,i,s,a){const n=[["#ffffff",10],["#000000",3]];t.lineCap="round";for(const a of n){const[n,o]=a;t.strokeStyle=n,t.lineWidth=o,t.beginPath(),t.moveTo(e-10,i),t.lineTo(e+10,i),t.moveTo(e,i),t.lineTo(e,s),t.moveTo(e-10,s),t.lineTo(e+10,s),t.stroke(),t.closePath()}t.font="12px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#000000",t.strokeStyle="#ffffff",t.strokeText(a,e,.5*(i+s)),t.fillText(a,e,.5*(i+s))}function l(t,e){const i=n(t.width,t.height);return i.drawImage(t,0,0),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),i.globalCompositeOperation="source-over",i.canvas}return async function(t={}){const e={textColors:["#ffffff"],backgroundColors:["#000000"],text:"8",font:"bold 256px sans-serif",padding:"20%",margin:"10%",circlePackerOptions:{},radius:"auto",debug:!1},i={...e,...t,circlePackerOptions:{...e.circlePackerOptions,...t.circlePackerOptions}};i.text=i.text.slice(0,2);const d=function(t,e){const i=n(2048,2048);i.font=e,i.textAlign="center",i.textBaseline="middle";const s=i.measureText(t),a=s.width,o=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;return{textWidth:a,textHeight:o,yOffset:1024-(1024-s.actualBoundingBoxAscent+.5*o),edgeLength:Math.max(a,o)}}(i.text,i.font),h="auto"===i.radius?d.edgeLength/2:i.radius,u=a(h,i.padding),g=a(2*u,i.margin),p=.5*g,m=.5*g+d.yOffset,f=r(g,g,p,m,i.text,i.font),x=n(g,g);x.beginPath(),x.arc(.5*g,.5*g,u,0,2*Math.PI),x.fill(),x.closePath();const y=l(o(g,g,i.backgroundColors),x.canvas),b=l(o(g,g,i.textColors),f),k=n(g,g);if(k.drawImage(y,0,0),k.drawImage(b,0,0),i.debug){const t=n(4*g,g);t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,4*g,g);const e=function(t,e,i,s,a,n,o){const l=r(t,e,i,s,a,n,"rgba(0, 0, 0, 0.5)"),d=l.getContext("2d");d.beginPath(),d.setLineDash([5,5]),d.lineWidth=2,d.font=n,d.textAlign="center",d.textBaseline="middle",d.strokeText(a,i,s-o.yOffset),d.closePath(),d.setLineDash([]);const h=s-2*o.yOffset-.5*o.textHeight;return c(d,.5*t+.5*o.textWidth,h,h+o.yOffset,"offset: "+o.yOffset.toFixed(2)+"px"),l}(g,g,p,m,i.text,i.font,d);t.drawImage(e,0,0),t.drawImage(k.canvas,2*g,0);const a=(await s(k.canvas,i.circlePackerOptions)).asCanvas({scale:1});t.drawImage(a,3*g,0);const o=n(g,g);return o.drawImage(f,0,0),o.fillStyle="rgba(255, 255, 255, 0.75)",o.beginPath(),o.rect(0,0,g,g),o.fill(),o.closePath(),o.drawImage(function(t,e,i){const s=n(e,i);s.lineWidth=2,s.beginPath(),s.arc(.5*e,.5*i,t.innerRadius,0,2*Math.PI),s.stroke(),s.closePath(),s.beginPath(),s.arc(.5*e,.5*i,t.backgroundRadius,0,2*Math.PI),s.stroke(),s.closePath();const a=.5*(t.edgeLength-2*t.backgroundRadius),o=`margin: ${a.toFixed(2)}px (${t.mergedOptions.margin})`;c(s,.5*e,0,a,o);const r=t.backgroundRadius-t.innerRadius,l=`padding: ${r.toFixed(2)}px (${t.mergedOptions.padding})`;c(s,.5*e,a+2*t.innerRadius+r,a+2*t.innerRadius+2*r,l);const d=t.innerRadius,h=`radius: ${d.toFixed(2)}px (${t.mergedOptions.radius})`;return c(s,.5*e,a+r,a+r+d,h),s.canvas}({innerRadius:h,backgroundRadius:u,edgeLength:g,mergedOptions:i},g,g),0,0),t.drawImage(o.canvas,g,0),new Proxy({},{get:()=>function(){return t.canvas}})}return await s(k.canvas,i.circlePackerOptions)}}();
