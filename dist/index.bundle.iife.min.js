var ishihara=function(){"use strict";var t=class{defaultOptions={spacing:1,numCircles:1e3,minRadius:1,maxRadius:10,higherAccuracy:!1,colors:"auto",minAlpha:1};defaultExportOptions={scale:window.devicePixelRatio,quality:1,format:"image/png"};options;spareCircles=[];placedCircles=[];dims={width:0,height:0};constructor(t={}){this.options={...this.defaultOptions,...t};for(let t=0;t<this.options.numCircles;t++)this.spareCircles.push({radius:this.options.minRadius+Math.random()*Math.random()*(this.options.maxRadius-this.options.minRadius)});this.spareCircles.sort(((t,e)=>t.radius-e.radius))}isFilled(t,e,i){return e=Math.round(e),i=Math.round(i),t.data[4*(this.dims.width*i+e)+3]>this.options.minAlpha}isCircleInside(t,e,i,s){if(!this.isFilled(t,e,i-s))return!1;if(!this.isFilled(t,e,i+s))return!1;if(!this.isFilled(t,e+s,i))return!1;if(!this.isFilled(t,e-s,i))return!1;if(this.options.higherAccuracy){const s=Math.cos(Math.PI/4);if(!this.isFilled(t,e+s,i+s))return!1;if(!this.isFilled(t,e-s,i+s))return!1;if(!this.isFilled(t,e-s,i-s))return!1;if(!this.isFilled(t,e+s,i-s))return!1}return!0}touchesPlacedCircle(t,e,i){return this.placedCircles.some((s=>this.dist(t,e,s.x,s.y)<s.radius+i+this.options.spacing))}dist(t,e,i,s){const n=t-i,a=e-s;return Math.sqrt(n*n+a*a)}getCircleColor(t,e,i){if("auto"===this.options.colors){e=Math.round(e),i=Math.round(i);const s=4*(this.dims.width*i+e);if(t.data[s+3]/255<this.options.minAlpha)return!1;return`rgb(${t.data[s]},${t.data[s+1]},${t.data[s+2]})`}return this.options.colors[Math.floor(Math.random()*this.options.colors.length)]}render(t,e){let i=this.spareCircles.length;for(this.dims={width:e,height:t.data.length/e/4};i>0;){i--;const e=this.spareCircles[i];let s=1e3;for(;!e.x&&s-- >0;){const i=Math.random()*this.dims.width,s=Math.random()*this.dims.height;if(this.isCircleInside(t,i,s,e.radius)&&!this.touchesPlacedCircle(i,s,e.radius)){const n=this.getCircleColor(t,i,s);n&&(e.x=i,e.y=s,e.color=n,this.placedCircles.push(e))}}}return this.placedCircles}asSVGString(){return`<svg width="${this.dims.width}" height="${this.dims.height}" viewBox="0 0 ${this.dims.width} ${this.dims.height}" xmlns="http://www.w3.org/2000/svg">`+this.placedCircles.map((t=>{const{x:e,y:i,radius:s,color:n}=t;return`<circle cx="${e}" cy="${i}" r="${s}" fill="${n}" />`})).join("")+"</svg>"}asSVG(){const t=this.asSVGString();return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement}asCanvas(t={}){const e=(t={...this.defaultExportOptions,...t}).scale,i=document.createElement("canvas");i.width=this.dims.width*e,i.height=this.dims.height*e;const s=i.getContext("2d");for(const t of this.placedCircles){const{x:i,y:n,radius:a,color:r}=t;s.fillStyle=String(r),s.beginPath(),s.arc(Number(i*e),Number(n*e),a*e,0,2*Math.PI),s.closePath(),s.fill()}return i}asImageData(t={}){t={...this.defaultExportOptions,...t};const e=this.asCanvas(t);return e.getContext("2d").getImageData(0,0,e.width,e.height)}async asBlob(t={}){t={...this.defaultExportOptions,...t};const e=this.asCanvas(t);return await new Promise(((i,s)=>{e.toBlob((t=>{t?i(t):s(new Error("Blob creation failed"))}),t.format,t.quality)}))}async asBlobURL(t={}){return URL.createObjectURL(await this.asBlob(t))}asDataURL(t={}){return t={...this.defaultExportOptions,...t},this.asCanvas().toDataURL(t.format,t.quality)}asArray(){return this.placedCircles}};function e(e,i={}){return function(e,i,s={}){const n=new t(s);return n.render(e,i),n}(e.getImageData(0,0,e.canvas.width,e.canvas.height),e.canvas.width,i)}function i(t,i={}){return e(t.getContext("2d"),i)}function s(t,e){return"number"==typeof e?e+t:t+t*(parseFloat(e)/100)*2}function n(t,e){return function(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i}(t,e).getContext("2d")}function a(t,e,i,s=4){const a=n(t,e);a.beginPath();for(let n=0;n<e;n+=s)for(let e=0;e<t;e+=s)a.fillStyle=i[Math.floor(Math.random()*i.length)],a.fillRect(e,n,s,s);return a.closePath(),a.canvas}function r(t,e,i,s,a,r,o="black"){const c=n(t,e);return c.font=r,c.textAlign="center",c.textBaseline="middle",c.fillStyle=o,c.fillText(a,i,s),c.canvas}function o(t,e,i,s,n){const a=[["#ffffff",10],["#000000",3]];t.lineCap="round";for(const n of a){const[a,r]=n;t.strokeStyle=a,t.lineWidth=r,t.beginPath(),t.moveTo(e-10,i),t.lineTo(e+10,i),t.moveTo(e,i),t.lineTo(e,s),t.moveTo(e-10,s),t.lineTo(e+10,s),t.stroke(),t.closePath()}t.font="12px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#000000",t.strokeStyle="#ffffff",t.strokeText(n,e,.5*(i+s)),t.fillText(n,e,.5*(i+s))}function c(t,e){const i=n(t.width,t.height);return i.drawImage(t,0,0),i.globalCompositeOperation="destination-in",i.drawImage(e,0,0),i.globalCompositeOperation="source-over",i.canvas}return function(t={}){const e={textColors:["#ffffff"],backgroundColors:["#000000"],text:"8",font:"bold 256px sans-serif",padding:"20%",margin:"10%",circlePackerOptions:{},radius:"auto",debug:!1},l={...e,...t,circlePackerOptions:{...e.circlePackerOptions,...t.circlePackerOptions}};l.text=l.text.slice(0,2);const d=function(t,e){const i=n(2048,2048);i.font=e,i.textAlign="center",i.textBaseline="middle";const s=i.measureText(t),a=s.width,r=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;return{textWidth:a,textHeight:r,yOffset:1024-(1024-s.actualBoundingBoxAscent+.5*r),edgeLength:Math.max(a,r)}}(l.text,l.font),h="auto"===l.radius?d.edgeLength/2:l.radius,u=s(h,l.padding),f=s(2*u,l.margin),g=.5*f,m=.5*f+d.yOffset,p=r(f,f,g,m,l.text,l.font),x=n(f,f);x.beginPath(),x.arc(.5*f,.5*f,u,0,2*Math.PI),x.fill(),x.closePath();const w=c(a(f,f,l.backgroundColors),x.canvas),C=c(a(f,f,l.textColors),p),b=n(f,f);if(b.drawImage(w,0,0),b.drawImage(C,0,0),l.debug){const t=n(4*f,f);t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,4*f,f);const e=function(t,e,i,s,n,a,c){const l=r(t,e,i,s,n,a,"rgba(0, 0, 0, 0.5)"),d=l.getContext("2d");d.beginPath(),d.setLineDash([5,5]),d.lineWidth=2,d.font=a,d.textAlign="center",d.textBaseline="middle",d.strokeText(n,i,s-c.yOffset),d.closePath(),d.setLineDash([]);const h=s-2*c.yOffset-.5*c.textHeight;return o(d,.5*t+.5*c.textWidth,h,h+c.yOffset,"offset: "+c.yOffset.toFixed(2)+"px"),l}(f,f,g,m,l.text,l.font,d);t.drawImage(e,0,0),t.drawImage(b.canvas,2*f,0);const s=i(b.canvas,l.circlePackerOptions).asCanvas({scale:1});t.drawImage(s,3*f,0);const a=n(f,f);return a.drawImage(p,0,0),a.fillStyle="rgba(255, 255, 255, 0.75)",a.beginPath(),a.rect(0,0,f,f),a.fill(),a.closePath(),a.drawImage(function(t,e,i){const s=n(e,i);s.lineWidth=2,s.beginPath(),s.arc(.5*e,.5*i,t.innerRadius,0,2*Math.PI),s.stroke(),s.closePath(),s.beginPath(),s.arc(.5*e,.5*i,t.backgroundRadius,0,2*Math.PI),s.stroke(),s.closePath();const a=.5*(t.edgeLength-2*t.backgroundRadius),r=`margin: ${a.toFixed(2)}px (${t.mergedOptions.margin})`;o(s,.5*e,0,a,r);const c=t.backgroundRadius-t.innerRadius,l=`padding: ${c.toFixed(2)}px (${t.mergedOptions.padding})`;o(s,.5*e,a+2*t.innerRadius+c,a+2*t.innerRadius+2*c,l);const d=t.innerRadius,h=`radius: ${d.toFixed(2)}px (${t.mergedOptions.radius})`;return o(s,.5*e,a+c,a+c+d,h),s.canvas}({innerRadius:h,backgroundRadius:u,edgeLength:f,mergedOptions:l},f,f),0,0),t.drawImage(a.canvas,f,0),new Proxy({},{get:()=>function(){return t.canvas}})}return i(b.canvas,l.circlePackerOptions)}}();
