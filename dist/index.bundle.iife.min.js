var ishihara=function(){"use strict";var t={pack(t,i,e,s){let a=e.length;const n=[],o={width:i,height:t.data.length/i/4};for(;a>0;){a--;const i=e[a];let r=1e3;for(;!i.x&&r-- >0;){const e=Math.random()*o.width,a=Math.random()*o.height;this.isCircleInside(t,o.width,e,a,i.radius,s.higherAccuracy,s.minAlpha)&&(this.touchesPlacedCircle(e,a,i.radius,n,s.spacing)||(i.x=e,i.y=a,n.push(i)))}}return n},isFilled:(t,i,e,s,a)=>(i=Math.round(i),e=Math.round(e),t.data[4*(s*e+i)+3]>a),isCircleInside(t,i,e,s,a,n,o){if(!this.isFilled(t,e,s-a,i,o))return!1;if(!this.isFilled(t,e,s+a,i,o))return!1;if(!this.isFilled(t,e+a,s,i,o))return!1;if(!this.isFilled(t,e-a,s,i,o))return!1;if(n){const a=Math.cos(Math.PI/4);if(!this.isFilled(t,e+a,s+a,i,o))return!1;if(!this.isFilled(t,e-a,s+a,i,o))return!1;if(!this.isFilled(t,e-a,s-a,i,o))return!1;if(!this.isFilled(t,e+a,s-a,i,o))return!1}return!0},touchesPlacedCircle(t,i,e,s,a){return s.some((s=>this.dist(t,i,s.x,s.y)<s.radius+e+a))},dist(t,i,e,s){const a=t-e,n=i-s;return Math.sqrt(a*a+n*n)}},i=class{defaultOptions={spacing:1,numCircles:1e3,minRadius:1,maxRadius:10,higherAccuracy:!1,colors:"auto",minAlpha:1,background:"transparent",useMainThread:!1,reuseWorker:!0};defaultExportOptions={scale:globalThis.devicePixelRatio||1,quality:1,format:"image/png"};options;spareCircles=[];placedCircles=[];dims={width:0,height:0};worker=null;constructor(t={}){this.options={...this.defaultOptions,...t},["transparent",null,"",!1,void 0].includes(this.options.background)&&(this.options.background=!1),"auto"===this.options.colors&&(this.options.colors=[]);for(let t=0;t<this.options.numCircles;t++)this.spareCircles.push({radius:this.options.minRadius+Math.random()*Math.random()*(this.options.maxRadius-this.options.minRadius)});this.spareCircles.sort(((t,i)=>t.radius-i.radius))}getCircleColor(t,i,e){if(0===this.options.colors.length){i=Math.min(Math.round(i),this.dims.width-1),e=Math.round(e);const s=4*(this.dims.width*e+i);if(t.data[s+3]/255<this.options.minAlpha)return!1;return`rgb(${t.data[s]},${t.data[s+1]},${t.data[s+2]})`}return this.options.colors[Math.floor(Math.random()*this.options.colors.length)]}async pack(i,e){let s=[];return"undefined"==typeof Worker||this.options.useMainThread?s=t.pack(i,e,this.spareCircles,this.options):(this.worker||(this.worker=new Worker("data:text/javascript;base64,dmFyIENvcmVfZGVmYXVsdD17cGFjayhpLHQsZSxzKXtsZXQgcj1lLmxlbmd0aDtjb25zdCBhPVtdLGQ9e3dpZHRoOnQsaGVpZ2h0OmkuZGF0YS5sZW5ndGgvdC80fTtmb3IoO3I+MDspe3ItLTtjb25zdCB0PWVbcl07bGV0IGg9MWUzO2Zvcig7IXQueCYmaC0tID4wOyl7Y29uc3QgZT1NYXRoLnJhbmRvbSgpKmQud2lkdGgscj1NYXRoLnJhbmRvbSgpKmQuaGVpZ2h0O3RoaXMuaXNDaXJjbGVJbnNpZGUoaSxkLndpZHRoLGUscix0LnJhZGl1cyxzLmhpZ2hlckFjY3VyYWN5LHMubWluQWxwaGEpJiYodGhpcy50b3VjaGVzUGxhY2VkQ2lyY2xlKGUscix0LnJhZGl1cyxhLHMuc3BhY2luZyl8fCh0Lng9ZSx0Lnk9cixhLnB1c2godCkpKX19cmV0dXJuIGF9LGlzRmlsbGVkOihpLHQsZSxzLHIpPT4odD1NYXRoLnJvdW5kKHQpLGU9TWF0aC5yb3VuZChlKSxpLmRhdGFbNCoocyplK3QpKzNdPnIpLGlzQ2lyY2xlSW5zaWRlKGksdCxlLHMscixhLGQpe2lmKCF0aGlzLmlzRmlsbGVkKGksZSxzLXIsdCxkKSlyZXR1cm4hMTtpZighdGhpcy5pc0ZpbGxlZChpLGUscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3Iscyx0LGQpKXJldHVybiExO2lmKCF0aGlzLmlzRmlsbGVkKGksZS1yLHMsdCxkKSlyZXR1cm4hMTtpZihhKXtjb25zdCByPU1hdGguY29zKE1hdGguUEkvNCk7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3IscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlLXIscytyLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlLXIscy1yLHQsZCkpcmV0dXJuITE7aWYoIXRoaXMuaXNGaWxsZWQoaSxlK3Iscy1yLHQsZCkpcmV0dXJuITF9cmV0dXJuITB9LHRvdWNoZXNQbGFjZWRDaXJjbGUoaSx0LGUscyxyKXtyZXR1cm4gcy5zb21lKChzPT50aGlzLmRpc3QoaSx0LHMueCxzLnkpPHMucmFkaXVzK2UrcikpfSxkaXN0KGksdCxlLHMpe2NvbnN0IHI9aS1lLGE9dC1zO3JldHVybiBNYXRoLnNxcnQocipyK2EqYSl9fTtzZWxmLm9ubWVzc2FnZT1pPT57cG9zdE1lc3NhZ2UoQ29yZV9kZWZhdWx0LnBhY2soaS5kYXRhLmltYWdlRGF0YSxpLmRhdGEuaW1hZ2VXaWR0aCxpLmRhdGEuc3BhcmVDaXJjbGVzLGkuZGF0YS5vcHRpb25zKSl9Ow==")),s=await new Promise((t=>{this.worker.onmessage=i=>t(i.data),this.worker.postMessage({imageData:i,imageWidth:e,spareCircles:this.spareCircles,options:this.options})})),this.options.reuseWorker||this.worker.terminate()),this.dims={width:e,height:i.data.length/e/4},this.placedCircles=s.reduce(((t,e)=>{const s=this.getCircleColor(i,e.x,e.y);return s&&(e.color=s,t.push(e)),t}),[]),this.placedCircles}asSVGString(){return`<svg width="${this.dims.width}" height="${this.dims.height}" viewBox="0 0 ${this.dims.width} ${this.dims.height}" xmlns="http://www.w3.org/2000/svg">`+(this.options.background?`<rect x="0" y="0" width="${this.dims.width}" height="${this.dims.height}" fill="${this.options.background}" />`:"")+this.placedCircles.map((t=>{const{x:i,y:e,radius:s,color:a}=t;return`<circle cx="${i}" cy="${e}" r="${s}" fill="${a}" />`})).join("")+"</svg>"}asSVG(){const t=this.asSVGString();return(new DOMParser).parseFromString(t,"image/svg+xml").documentElement}asCanvas(t={}){const i=(t={...this.defaultExportOptions,...t}).scale,e=document.createElement("canvas");e.width=this.dims.width*i,e.height=this.dims.height*i;const s=e.getContext("2d");this.options.background&&(s.fillStyle=this.options.background,s.fillRect(0,0,e.width,e.height));for(const t of this.placedCircles){const{x:e,y:a,radius:n,color:o}=t;s.fillStyle=String(o),s.beginPath(),s.arc(Number(e*i),Number(a*i),n*i,0,2*Math.PI),s.closePath(),s.fill()}return e}asImageData(t={}){t={...this.defaultExportOptions,...t};const i=this.asCanvas(t);return i.getContext("2d").getImageData(0,0,i.width,i.height)}async asBlob(t={}){t={...this.defaultExportOptions,...t};const i=this.asCanvas(t);return await new Promise(((e,s)=>{i.toBlob((t=>{t?e(t):s(new Error("Blob creation failed"))}),t.format,t.quality)}))}async asBlobURL(t={}){return URL.createObjectURL(await this.asBlob(t))}asDataURL(t={}){return t={...this.defaultExportOptions,...t},this.asCanvas().toDataURL(t.format,t.quality)}asArray(){return this.placedCircles}};async function e(t,e={}){return await async function(t,e,s={}){const a=new i(s);return await a.pack(t,e),a}(t.getImageData(0,0,t.canvas.width,t.canvas.height),t.canvas.width,e)}async function s(t,i={}){const s=t.getContext("2d");return await e(s,i)}function a(t,i){return"number"==typeof i?i+t:t+t*(parseFloat(i)/100)*2}function n(t,i){return function(t,i){const e=document.createElement("canvas");return e.width=t,e.height=i,e}(t,i).getContext("2d")}function o(t,i,e,s=4){const a=n(t,i);a.beginPath();for(let n=0;n<i;n+=s)for(let i=0;i<t;i+=s)a.fillStyle=e[Math.floor(Math.random()*e.length)],a.fillRect(i,n,s,s);return a.closePath(),a.canvas}function r(t,i,e,s,a,o,r="black"){const c=n(t,i);return c.font=o,c.textAlign="center",c.textBaseline="middle",c.fillStyle=r,c.fillText(a,e,s),c.canvas}function c(t,i,e,s,a){const n=[["#ffffff",10],["#000000",3]];t.lineCap="round";for(const a of n){const[n,o]=a;t.strokeStyle=n,t.lineWidth=o,t.beginPath(),t.moveTo(i-10,e),t.lineTo(i+10,e),t.moveTo(i,e),t.lineTo(i,s),t.moveTo(i-10,s),t.lineTo(i+10,s),t.stroke(),t.closePath()}t.font="12px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#000000",t.strokeStyle="#ffffff",t.strokeText(a,i,.5*(e+s)),t.fillText(a,i,.5*(e+s))}function l(t,i){const e=n(t.width,t.height);return e.drawImage(t,0,0),e.globalCompositeOperation="destination-in",e.drawImage(i,0,0),e.globalCompositeOperation="source-over",e.canvas}return async function(t={}){const i={textColors:["#ffffff"],backgroundColors:["#000000"],text:"8",font:"bold 256px sans-serif",padding:"20%",margin:"10%",circlePackerOptions:{},radius:"auto",debug:!1},e={...i,...t,circlePackerOptions:{...i.circlePackerOptions,...t.circlePackerOptions}};e.text=e.text.slice(0,2);const h=function(t,i){const e=n(2048,2048);e.font=i,e.textAlign="center",e.textBaseline="middle";const s=e.measureText(t),a=s.width,o=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent;return{textWidth:a,textHeight:o,yOffset:1024-(1024-s.actualBoundingBoxAscent+.5*o),edgeLength:Math.max(a,o)}}(e.text,e.font),d="auto"===e.radius?h.edgeLength/2:e.radius,u=a(d,e.padding),g=a(2*u,e.margin),p=.5*g,m=.5*g+h.yOffset,f=r(g,g,p,m,e.text,e.font),x=n(g,g);x.beginPath(),x.arc(.5*g,.5*g,u,0,2*Math.PI),x.fill(),x.closePath();const y=l(o(g,g,e.backgroundColors),x.canvas),b=l(o(g,g,e.textColors),f),k=n(g,g);if(k.drawImage(y,0,0),k.drawImage(b,0,0),e.debug){const t=n(4*g,g);t.fillStyle="rgb(255, 255, 255)",t.fillRect(0,0,4*g,g);const i=function(t,i,e,s,a,n,o){const l=r(t,i,e,s,a,n,"rgba(0, 0, 0, 0.5)"),h=l.getContext("2d");h.beginPath(),h.setLineDash([5,5]),h.lineWidth=2,h.font=n,h.textAlign="center",h.textBaseline="middle",h.strokeText(a,e,s-o.yOffset),h.closePath(),h.setLineDash([]);const d=s-2*o.yOffset-.5*o.textHeight;return c(h,.5*t+.5*o.textWidth,d,d+o.yOffset,"offset: "+o.yOffset.toFixed(2)+"px"),l}(g,g,p,m,e.text,e.font,h);t.drawImage(i,0,0),t.drawImage(k.canvas,2*g,0);const a=(await s(k.canvas,e.circlePackerOptions)).asCanvas({scale:1});t.drawImage(a,3*g,0);const o=n(g,g);return o.drawImage(f,0,0),o.fillStyle="rgba(255, 255, 255, 0.75)",o.beginPath(),o.rect(0,0,g,g),o.fill(),o.closePath(),o.drawImage(function(t,i,e){const s=n(i,e);s.lineWidth=2,s.beginPath(),s.arc(.5*i,.5*e,t.innerRadius,0,2*Math.PI),s.stroke(),s.closePath(),s.beginPath(),s.arc(.5*i,.5*e,t.backgroundRadius,0,2*Math.PI),s.stroke(),s.closePath();const a=.5*(t.edgeLength-2*t.backgroundRadius),o=`margin: ${a.toFixed(2)}px (${t.mergedOptions.margin})`;c(s,.5*i,0,a,o);const r=t.backgroundRadius-t.innerRadius,l=`padding: ${r.toFixed(2)}px (${t.mergedOptions.padding})`;c(s,.5*i,a+2*t.innerRadius+r,a+2*t.innerRadius+2*r,l);const h=t.innerRadius,d=`radius: ${h.toFixed(2)}px (${t.mergedOptions.radius})`;return c(s,.5*i,a+r,a+r+h,d),s.canvas}({innerRadius:d,backgroundRadius:u,edgeLength:g,mergedOptions:e},g,g),0,0),t.drawImage(o.canvas,g,0),new Proxy({},{get:()=>function(){return t.canvas}})}return await s(k.canvas,e.circlePackerOptions)}}();
